<html xmlns="http://www.w3.org/1999/xhtml" xmlns:n="http://nevow.com/ns/nevow/0.1">
  <head>
    <!-- per http://www.piclens.com/lite/webmasterguide.php -->
    <link rel="alternate" href="?rss=1" 
	  type="application/rss+xml" title="" id="gallery" />
    <script type="text/javascript" 
          src="http://lite.piclens.com/current/piclens.js" ></script>

    <!-- if we're on a phone screen, things should shrink accordingly -->
   <link rel="Stylesheet" type="text/css" href="static/styles.css" media="all" />
    <title><n:invisible n:render="title"/></title>
  </head>
  <body>
    <div><n:invisible n:render="loginWidget"/></div>
	    <div id="ajaxError" style="display:none"/>
    <h1>Pictures of <span class="tag"><n:invisible n:render="setLabel"/></span></h1>

    <div class="intro" n:render="intro"></div>

    <div class="featured">
      <h2><n:invisible n:render="currentLabel">Mark and Stephanie play Magic [1 of 16]</n:invisible></h2>
      
      <div style="width:1000px">
	<div style="float: left; width: 600px">
	  <div><img width="500" height="300" alt="Mark and Stephanie" n:render="featured"/></div>
	  <n:invisible n:render="stepButtons"/>
	</div>
	<div style="float: left; width: 400px">
	  <div class="actions">
	    <h2>Actions</h2>
	    <div class="ac"><n:invisible n:render="public"/></div>
	    <div class="ac"><n:invisible n:render="uploadButton"/></div>
	    <div class="ac" style="opacity: .4">Email</div>
	    <div class="ac" style="opacity: .4">Post to blog</div>
	    <div class="ac"><a><n:attr name="href">http://bang:8080/openrdf-workbench/repositories/photo/explore?resource=&lt;<n:invisible n:render="currentPhotoUri"/>&gt;</n:attr>Debug rdf</a></div>

	    <h2>Other versions</h2>
	    <div class="ac"><n:invisible n:render="fullSizeLink">Full size</n:invisible></div>
	    <div class="ac">
	      <div>Link to this image: </div>
	      <div style="font-size: 60%"><n:invisible n:render="link"/></div>
	    </div>

	  </div>
	</div>
	<div style="clear: both"/>
      </div>
    </div>

    <table id="t1">
      <tr>
	<td>
	  <div class="imageInfo">
	    <n:invisible n:render="facts"/>
	  </div>
	</td>

	<td>
	  <div class="tagging">
	    <div>Tags: <input type="text" id="tags"/> </div>
	    <div>Description: <textarea id="desc"></textarea></div>
	    <div><button id="saveMeta">save</button> <span id="saveStatus"/></div>
	  </div>
	  <div>Other images with tag:</div>
	  <div id="otherWithTag"/>
	</td>
	<td>
	  <div id="comments" style="height:165px"></div>
	</td>
      </tr>
    </table>
    <div>
      <h2>All photos in set:</h2>
      <div>
        <a href="javascript:PicLensLite.start();">View as slideshow 
        <img src="http://lite.piclens.com/images/PicLensButton.png" 
	     alt="PicLens" width="16" height="12" border="0" 
	     align="absmiddle" /></a>
      </div>
      <div class="photosInSet">
	<n:invisible n:render="sequence" n:data="photosInSet">
	  <n:invisible n:pattern="item">
	    <n:invisible n:render="thumb"/>
	  </n:invisible>
	  <img width="70" height="50"/>
	  <img width="70" height="50"/>
	</n:invisible>
      </div>
    </div>
    <div>
      Download a <a rel="nofollow"><n:attr name="href"><n:invisible n:render="zipUrl"/></n:attr>.zip file of the full size images on this page</a> <n:invisible n:render="zipSizeWarning"/>
    </div>


    <!--    <div>
	 <h2>Related</h2>
	 
	 </div>-->

    <script type="text/javascript" src="/static/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="/static/jquery.form.js"></script>
    <script type="text/javascript" n:render="prevNextJs"/>
    
    <script type="text/javascript">
      var currentPhotoUri = "<n:invisible n:render="currentPhotoUri"/>";
      var preloadImg = "<n:invisible n:render="nextImagePreload"/>";
    </script>

    <script type="text/javascript">
      // <![CDATA[

      $(function () {

	  function startNextImgPreload() {
	      $("#preload").attr('src', preloadImg);
	  }

	  $(window).keydown(function (e) {
	      if (e.which == 37) { 
		  document.location = arrowPages.prev;
	      } else if (e.which == 39) {
		  document.location = arrowPages.next;
	      }

	  });

	  $.get("/comments", 
		{post: currentPhotoUri}, 
		function (result) { 
		    $("#comments").html(result); 
		    $("#comments").removeAttr("style");
		}, "html");

	  $("#saveMeta").click(function () {
	      $("#saveStatus").text("");
	      $.post("/tagging", {
		  img: currentPhotoUri,
		  tags: $("#tags").val(),
		  desc: $("#desc").val()}, 
		     function(data) { 
			 $("#saveStatus").text("ok");
			 refreshTags(data);
		     },
		     "json");
	  });

	  function refreshTags(data) {
	      $("#tags").val(data.tagString);
	      $("#desc").val(data.desc);

	      $("#otherWithTag").empty();
	      $.each(data.tags, function (i, tag) {
		  $("#otherWithTag").append("<div><a href=\"/set?tag="+tag+"\">"+tag+"</a></div>");
	      });
		    startNextImgPreload(); // try to do this after other work

	  }

	  $.getJSON("/tagging", 
		    {img: currentPhotoUri},
		    refreshTags);

	  $("#ajaxError").ajaxError(function (event, xhr, ajaxOptions) {
	      $(this).show();
	      $(this).append("<p>Ajax error: "+xhr.responseText+"</p>");
	  });

          $(".makePub").click(function() {
	      var button = $(this);
	      $.post('makePublic', {uri: currentPhotoUri},
		  function(data, textStatus) {
		    button.replaceWith(data);
	      });
	  });
		  
      });

      function flickrUpload() {
	  var st = $("#flickrUpload");

          var sz = $("#flickrUpload input[name=size]:checked").val();
	  st.html('Uploading... ' +
		  '<img class="spinner" src="static/snake-spinner.gif"/>');
		  
	  $.post("http://photo.bigasterisk.com/flickrUpload/",
		 {img: currentPhotoUri,
		  size: sz,
		  test: ''}, 
		 function (data) {
		     st.html("Done: " +
			     "<a href=\""+data.flickrUrl+"\">flickr copy</a>");
		 }, "json");
      }

      

      // ]]>
    </script>

    <img id="preload" src=""/>
highlight selection, tag all its images with an event. link to just view that event, from any pic go view its directory, email whole event to someone from access.n3 list
  </body>
</html>
