<html xmlns="http://www.w3.org/1999/xhtml" xmlns:n="http://nevow.com/ns/nevow/0.1">
  <head>
    <!-- per http://www.piclens.com/lite/webmasterguide.php -->
    <link rel="alternate" href="?rss=1" 
	  type="application/rss+xml" title="" id="gallery" />
    <script type="text/javascript" 
          src="http://lite.piclens.com/current/piclens.js" />

    <!-- if we're on a phone screen, things should shrink accordingly -->
    <style type="text/css">
* {
font-family: sans-serif;

}
body {
  background: black;
  color: white;
}
h1 {
  font-size: 110%;
}
h2 {
  font-size: 105%;
}
a {
  color: #ccf;
} 
div {
  margin-left: 2em;
}
div.imageInfo {
  margin: 1em;
  padding: 1em;
  position: relative; 
  border: 1px solid gray;
  float:right;
width:10em;
}
img {
  border: 1px solid #668;
}  
div.intro {
  border: 1px solid gray;
  padding-left: 1em;
  margin-right: 10%;
  background: #502000;
}
span.imageLink {
  color: #666;
}
div.featured {
  margin-bottom: 1em;
}
img.not-current {
  margin: 2px;
} 
img.current {
  border: 2px solid #ffc;
  padding: 1px;
}
img.preload {
  width: 0px;
}
span img {
 width: 75px;
height: 56px;
} 


div#comments {
  background: #005;
  padding: 2px;
  width: 300px;
}
#comments textarea {
 width: 250px;
}
#comments li { 
list-style: square;
border-top: 1px solid #00a;
}



div.tagging {
width: 350px;
background: #031;
padding: 2px;
}

#tags, #desc {
border:1px outset gray;
padding:5px;
}

#tags {
width:260px;
}
#desc {
 vertical-align: baseline;
}
#t1 td {
 vertical-align: top;
}
#saveStatus {
color: #555;
}

    </style>
    <title><n:invisible n:render="title"/></title>
  </head>
  <body>
    <div><n:invisible n:render="loginWidget"/></div>

    <h1>Pictures of <span class="tag"><n:invisible n:render="setLabel"/></span></h1>

    <div>
      <a href="javascript:PicLensLite.start();">View as slideshow 
      <img src="http://lite.piclens.com/images/PicLensButton.png" 
	   alt="PicLens" width="16" height="12" border="0" 
	   align="absmiddle" /></a>
    </div>

    <div class="intro" n:render="intro"></div>

    <div class="featured">
      <h2><n:invisible n:render="currentLabel">Mark and Stephanie play Magic [1 of 16]</n:invisible></h2>
      <div>
	<img width="500" height="300" alt="Mark and Stephanie" n:render="featured"/>
	<div class="imageInfo">
          <n:invisible n:render="facts"/>
	</div>

      </div>
    </div>

	  <div>Click image for next</div>
	  <div><n:invisible n:render="fullSizeLink">See this pic at full size</n:invisible></div>
	  <div><span class="imageLink">Link to this image: <n:invisible n:render="link"/></span></div>
	  <div><a><n:attr name="href">http://plus:8080/openrdf-workbench/repositories/photo/explore?resource=&lt;<n:invisible n:render="currentPhotoUri"/>&gt;</n:attr>rdf workbench</a></div>

    <table id="t1">
      <tr>
	<td>

	  <div class="tagging">
	    <div>Tags: <input type="text" id="tags"/> </div>
	    <div>Description: <textarea id="desc"></textarea></div>
	    <div><button id="saveMeta">save</button> <span id="saveStatus"/></div>
	  </div>
	  <div>Other images with tag:</div>
	  <div id="otherWithTag"/>
	</td>
	<td>

	  <div id="comments"></div>
	</td>
      </tr>
    </table>
    <div>
      <h2>All photos in set:</h2>
      <div>
	<n:invisible n:render="sequence" n:data="photosInSet">
	  <n:invisible n:pattern="item">
	    <span><n:invisible n:render="thumb"/></span>
	  </n:invisible>
	  <img width="70" height="50"/>
	  <img width="70" height="50"/>
	</n:invisible>
      </div>
    </div>
    <div>
      Download a <a rel="nofollow"><n:attr name="href"><n:invisible n:render="zipUrl"/></n:attr>.zip file of the full size images on this page</a> <n:invisible n:render="zipSizeWarning"/>
    </div>


    <!--    <div>
	 <h2>Related</h2>
	 
	 </div>-->

    <script type="text/javascript" src="/static/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="/static/jquery.form.js"></script>
    <script type="text/javascript" n:render="prevNextJs"/>
    
    <script type="text/javascript">
      var currentPhotoUri = "<n:invisible n:render="currentPhotoUri"/>";
    </script>

    <script type="text/javascript">
      // <![CDATA[

$(function () {
    $(window).keydown(function (e) {
	if (e.which == 37) { 
	    document.location = arrowPages.prev;
	} else if (e.which == 39) {
	    document.location = arrowPages.next;
	}

    });

    $.get("/comments", 
          {post: currentPhotoUri}, 
          function (result) { $("#comments").html(result); }, "html");

    $("#saveMeta").click(function () {
    $("#saveStatus").text("");
    $.post("/tagging", {
      img: currentPhotoUri,
      tags: $("#tags").val(),
      desc: $("#desc").val()}, 
      function(data) { 
      $("#saveStatus").text("ok");
      refreshTags(data);
      },
      "json");
    });

    function refreshTags(data) {
       $("#tags").val(data.tagString);
       $("#desc").val(data.desc);

       $("#otherWithTag").empty();
       $.each(data.tags, function (i, tag) {
         $("#otherWithTag").append("<div><a href=\"/set?tag="+tag+"\">"+tag+"</a></div>");
       });
    }

    $.getJSON("/tagging", 
              {img: currentPhotoUri},
	      refreshTags);

    });
    // ]]>
    </script>

    <n:invisible n:render="nextImagePreload"/>

  </body>
</html>
