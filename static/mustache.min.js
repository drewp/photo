var Mustache=function(){var a={};var b=function(){};b.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(a,b,c,d){if(!d){this.context=b;this.buffer=[]}if(!this.includes("",a)){if(d){return a}else{this.send(a);return}}a=this.render_pragmas(a);var e=this.render_section(a,b,c);if(e===false){e=this.render_tags(a,b,c,d)}if(d){return e}else{this.sendLines(e)}},send:function(a){if(a!==""){this.buffer.push(a)}},sendLines:function(a){if(a){var b=a.split("\n");for(var c=0;c<b.length;c++){this.send(b[c])}}},render_pragmas:function(a){if(!this.includes("%",a)){return a}var b=this;var c=this.getCachedRegex("render_pragmas",function(a,b){return new RegExp(a+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+b,"g")});return a.replace(c,function(a,c,d){if(!b.pragmas_implemented[c]){throw{message:"This implementation of mustache doesn't understand the '"+c+"' pragma"}}b.pragmas[c]={};if(d){var e=d.split("=");b.pragmas[c][e[0]]=e[1]}return""})},render_partial:function(a,b,c){a=this.trim(a);if(!c||c[a]===undefined){throw{message:"unknown_partial '"+a+"'"}}if(typeof b[a]!="object"){return this.render(c[a],b,c,true)}return this.render(c[a],b[a],c,true)},render_section:function(a,b,c){if(!this.includes("#",a)&&!this.includes("^",a)){return false}var d=this;var e=this.getCachedRegex("render_section",function(a,b){return new RegExp("^([\\s\\S]*?)"+a+"(\\^|\\#)\\s*(.+)\\s*"+b+"\n*([\\s\\S]*?)"+a+"\\/\\s*\\3\\s*"+b+"\\s*([\\s\\S]*)$","g")});return a.replace(e,function(a,e,f,g,h,i){var j=e?d.render_tags(e,b,c,true):"",k=i?d.render(i,b,c,true):"",l,m=d.find(g,b);if(f==="^"){if(!m||d.is_array(m)&&m.length===0){l=d.render(h,b,c,true)}else{l=""}}else if(f==="#"){if(d.is_array(m)){l=d.map(m,function(a){return d.render(h,d.create_context(a),c,true)}).join("")}else if(d.is_object(m)){l=d.render(h,d.create_context(m),c,true)}else if(typeof m==="function"){l=m.call(b,h,function(a){return d.render(a,b,c,true)})}else if(m){l=d.render(h,b,c,true)}else{l=""}}return j+l+k})},render_tags:function(a,b,c,d){var e=this;var f=function(){return e.getCachedRegex("render_tags",function(a,b){return new RegExp(a+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+b+"+","g")})};var g=f();var h=function(a,d,h){switch(d){case"!":return"";case"=":e.set_delimiters(h);g=f();return"";case">":return e.render_partial(h,b,c);case"{":return e.find(h,b);default:return e.escape(e.find(h,b))}};var i=a.split("\n");for(var j=0;j<i.length;j++){i[j]=i[j].replace(g,h,this);if(!d){this.send(i[j])}}if(d){return i.join("\n")}},set_delimiters:function(a){var b=a.split(" ");this.otag=this.escape_regex(b[0]);this.ctag=this.escape_regex(b[1])},escape_regex:function(a){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+b.join("|\\")+")","g")}return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){function c(a){return a===false||a===0||a}a=this.trim(a);var d;if(c(b[a])){d=b[a]}else if(c(this.context[a])){d=this.context[a]}if(typeof d==="function"){return d.apply(b)}if(d!==undefined){return d}return""},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(a){a=String(a===null?"":a);return a.replace(/&(?!\w+;)|["'<>\\]/g,function(a){switch(a){case"&":return"&";case'"':return""";case"'":return"&#39;";case"<":return"<";case">":return">";default:return a}})},create_context:function(a){if(this.is_object(a)){return a}else{var b=".";if(this.pragmas["IMPLICIT-ITERATOR"]){b=this.pragmas["IMPLICIT-ITERATOR"].iterator}var c={};c[b]=a;return c}},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function"){return a.map(b)}else{var c=[];var d=a.length;for(var e=0;e<d;e++){c.push(b(a[e]))}return c}},getCachedRegex:function(b,c){var d=a[this.otag];if(!d){d=a[this.otag]={}}var e=d[this.ctag];if(!e){e=d[this.ctag]={}}var f=e[b];if(!f){f=e[b]=c(this.otag,this.ctag)}return f}};return{name:"mustache.js",version:"0.4.0-dev",to_html:function(a,c,d,e){var f=new b;if(e){f.send=e}f.render(a,c||{},d);if(!e){return f.buffer.join("\n")}}}}()
