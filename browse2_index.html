<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/">
  <head>
    <title>browse2</title>
  </head>
  <body>
    Subdirs:
    <div><a href="?dir=${parent}">[parent]</a></div>
    <div py:for="row in subdirs">
      <a href="?dir=${row['subdir']}">${str(row['subdir'])}</a>
    </div>


    <py:for each="(title, items) in [('Contents', contents), ('Most recent pics', recent)]">

      ${title}:
      <div py:for="row in items" about="${row['pic']}">
	${row.get('dateTime', '?')} 
	<a href="${row['pic']}?size=large">
	  <img height="80" src="${row['pic']}?size=small"/>
	  [link to large]
	</a>
	<py:choose test="viewable(row['pic'])">
	  <button py:when="False" class="makePub">Make public</button>
	  <span py:when="True">public</span>
	</py:choose>
      </div>
    </py:for>
      
    <script type="text/javascript" src="http://photo.bigasterisk.com/static/jquery-1.3.2.min.js"></script>
    <script type="text/javascript">
      // <![CDATA[
      $(document).ready(function() {
	  console.log('read');
	  $(".makePub").click(function() {
	      var uri = $(this).parent().attr('about');
	      var button = $(this);
	      $.post('makePublic', {uri: uri}, function(data, textStatus) {
		  button.replaceWith("<span>" + data + "</span>");
	      });
	  });
      });

      // ]]>
    </script>
  </body>
</html>